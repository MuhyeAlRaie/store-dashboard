<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم المتجر</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .table-responsive { max-height: 400px; overflow-y: auto; }
    .section { margin-bottom: 60px; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body class="p-4">
  <div class="container">
    <h2 class="mb-4">🛒 لوحة تحكم المتجر</h2>

    <!-- قسم عرض وإدارة المنتجات -->
    <div class="section">
      <h4 class="mb-3">📦 إدارة المنتجات</h4>
      <div class="row">
        <div class="col-lg-8">
          <div class="table-responsive mb-4">
            <table class="table table-bordered table-striped" id="productsTable">
              <thead class="table-light">
                <tr>
                  <th>الاسم</th>
                  <th>السعر</th>
                  <th>السعر السابق</th>
                  <th>التصنيف</th>
                  <th>الوصف المختصر</th>
                  <th>متوفر</th>
                  <th>تعديل</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-4">
          <h6 class="mb-3">✏️ تعديل / إضافة منتج</h6>
          <form id="productForm">
            <input type="hidden" id="product-id">
            <div class="mb-2"><input class="form-control" id="product-name" placeholder="اسم المنتج"></div>
            <div class="mb-2"><input class="form-control" id="product-price" placeholder="السعر"></div>
            <div class="mb-2"><input class="form-control" id="product-oldPrice" placeholder="السعر السابق"></div>
            <div class="mb-2"><input class="form-control" id="product-category" placeholder="التصنيف"></div>
            <div class="mb-2"><input class="form-control" id="product-shortDesc" placeholder="الوصف المختصر"></div>
            <div class="mb-2"><input class="form-control" id="product-description" placeholder="الوصف الكامل"></div>
            <div class="mb-2"><input class="form-control" id="product-colors" placeholder="الألوان (مفصولة بفاصلة)"></div>
            <div class="mb-2"><input class="form-control" id="product-images" placeholder="رابط الصور (مفصولة بفاصلة)"></div>
            <div class="mb-2"><input class="form-control" id="product-available" placeholder="متوفر؟ yes/no"></div>
            <button class="btn btn-success w-100" type="submit">💾 حفظ المنتج</button>
          </form>
        </div>
      </div>
    </div>

    <!-- قسم عرض الطلبات -->
    <div class="section">
      <h4 class="mb-3">🧾 الطلبات</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="ordersTable">
          <thead class="table-light">
            <tr>
              <th>الاسم</th>
              <th>الهاتف</th>
              <th>المنطقة</th>
              <th>العنوان</th>
              <th>الدفع</th>
              <th>المنتجات</th>
              <th>رسوم التوصيل</th>
              <th>الخصم</th>
              <th>كوبون</th>
              <th>الإجمالي</th>
              <th>التاريخ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const PRODUCTS_API_URL = "https://script.google.com/macros/s/AKfycbyWjt64bxMAJIoaV1FbAQoYEU0wHRFJ7EUFGgBq4YNWqBWKmAQFBTHCDDCBoLLla40gnQ/exec";
    const ORDERS_API_URL = "https://script.google.com/macros/s/AKfycbzX6MUglLN46AlqD99QZ7LY31e3IWFx8BopRcfPewX0mO7gbHPzsFG-yTzVRQUqmGlH/exec";

    // تحميل المنتجات
    function loadProducts() {
      fetch(PRODUCTS_API_URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#productsTable tbody");
          tbody.innerHTML = '';

          data.forEach(p => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${p.name}</td>
              <td>${p.price}</td>
              <td>${p.oldPrice}</td>
              <td>${p.category}</td>
              <td>${p.shortDesc}</td>
              <td>${p.available}</td>
              <td><button class="btn btn-sm btn-warning" onclick='editProduct(${JSON.stringify(p)})'>✎</button></td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function editProduct(p) {
      document.getElementById('product-id').value = p.id || '';
      document.getElementById('product-name').value = p.name || '';
      document.getElementById('product-price').value = p.price || '';
      document.getElementById('product-oldPrice').value = p.oldPrice || '';
      document.getElementById('product-category').value = p.category || '';
      document.getElementById('product-shortDesc').value = p.shortDesc || '';
      document.getElementById('product-description').value = p.description || '';
      document.getElementById('product-images').value = p.images || '';
      document.getElementById('product-colors').value = p.colors || '';
      document.getElementById('product-available').value = p.available || '';
    }

    document.getElementById("productForm").addEventListener("submit", e => {
      e.preventDefault();
      const data = {
        id: document.getElementById('product-id').value || Date.now(),
        name: document.getElementById('product-name').value,
        price: document.getElementById('product-price').value,
        oldPrice: document.getElementById('product-oldPrice').value,
        category: document.getElementById('product-category').value,
        shortDesc: document.getElementById('product-shortDesc').value,
        description: document.getElementById('product-description').value,
        available: document.getElementById('product-available').value,
        colors: document.getElementById('product-colors').value,
        images: document.getElementById('product-images').value,
      };
      fetch(PRODUCTS_API_URL, {
        method: "POST",
        body: JSON.stringify(data),
      }).then(() => {
        loadProducts();
        e.target.reset();
      });
    });

    // تحميل الطلبات
    function loadOrders() {
      fetch(ORDERS_API_URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#ordersTable tbody");
          tbody.innerHTML = '';

          data.forEach(order => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${order.name}</td>
              <td>${order.phone}</td>
              <td>${order.area}</td>
              <td>${order.address}</td>
              <td>${order.payment}</td>
              <td><pre>${order.items}</pre></td>
              <td>${order.deliveryFee}</td>
              <td>${order.discountAmount}</td>
              <td>${order.coupon}</td>
              <td>${order.total}</td>
              <td>${new Date(order.date || order.Timestamp).toLocaleString()}</td>`;
            tbody.appendChild(tr);
          });
        });
    }

    loadProducts();
    loadOrders();
  </script>
</body>
</html>
