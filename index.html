<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .table-responsive { max-height: 400px; overflow-y: auto; }
    .section { margin-bottom: 60px; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
    #product-message {
  font-weight: bold;
  text-align: center;
  font-size: 1rem;
  z-index: 9999;
}
  </style>
</head>
<body class="p-4">

<div id="loginBox" style="max-width: 300px; margin: 100px auto;">
  <h5 class="text-center mb-3">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h5>
  <input type="text" id="adminUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="form-control mb-2">
  <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="form-control mb-2">
  <button onclick="verifyLogin()" class="btn btn-primary w-100">Ø¯Ø®ÙˆÙ„</button>
  <div id="loginError" class="text-danger mt-2 text-center"></div>
</div>

<div id="dashboardContent" style="display:none;">
  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù‡Ù†Ø§ -->
   <button onclick="logout()" class="btn btn-outline-danger btn-sm">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<script>
  function logout() {
    localStorage.removeItem("dashboard-auth");
    location.reload();
  }
</script>
    <div class="container">
    <h2 class="mb-4">ğŸ›’ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</h2>

    <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="section">
      <h4 class="mb-3">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
      <div class="row">
        <div class="col-lg-8">
          <div class="table-responsive mb-4">
            <table class="table table-bordered table-striped" id="productsTable">
              <thead class="table-light">
                <tr>
                  <th>Ø§Ù„Ø§Ø³Ù…</th>
                  <th>Ø§Ù„Ø³Ø¹Ø±</th>
                  <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
                  <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                  <th>Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø®ØªØµØ±</th>
                  <th>Ù…ØªÙˆÙØ±</th>
                  <th>ØªØ¹Ø¯ÙŠÙ„</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-4">
          <h6 class="mb-3">âœï¸ ØªØ¹Ø¯ÙŠÙ„ / Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h6>
          <form id="productForm">
            <input type="hidden" id="product-id">
            <div class="mb-2"><input class="form-control" id="product-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"></div>
            <div class="mb-2"><input class="form-control" id="product-price" placeholder="Ø§Ù„Ø³Ø¹Ø±"></div>
            <div class="mb-2"><input class="form-control" id="product-oldPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚"></div>
            <div class="mb-2"><input class="form-control" id="product-category" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ"></div>
            <div class="mb-2"><input class="form-control" id="product-shortDesc" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø®ØªØµØ±"></div>
            <div class="mb-2"><input class="form-control" id="product-description" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙƒØ§Ù…Ù„"></div>
            <div class="mb-2"><input class="form-control" id="product-colors" placeholder="Ø§Ù„Ø£Ù„ÙˆØ§Ù† (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)"></div>
            <div class="mb-3">
  <label for="product-image-file" class="form-label">ğŸ“· ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬</label>
  <input type="file" id="product-image-file" class="form-control mb-2" multiple accept="image/*">
  <input type="hidden" id="product-images">
  <div id="upload-status" class="text-muted small"></div>
</div>
            <div class="mb-2"><input class="form-control" id="product-available" placeholder="Ù…ØªÙˆÙØ±ØŸ yes/no"></div>
            <button class="btn btn-success w-100" type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
            <div id="product-message" class="alert alert-success mt-3" role="alert" style="display: none;"></div>

          </form>
        </div>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div class="section">
      <h4 class="mb-3">ğŸ§¾ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4>
<div class="mb-3">
  <input type="text" id="searchOrdersInput" class="form-control" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ®..." oninput="filterOrders()">
</div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="ordersTable">
          <thead class="table-light">
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
              <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
              <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
              <th>Ø§Ù„Ø¯ÙØ¹</th>
              <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
              <th>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</th>
              <th>Ø§Ù„Ø®ØµÙ…</th>
              <th>ÙƒÙˆØ¨ÙˆÙ†</th>
              <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

 
<script>
  const LOGIN_API = "https://script.google.com/macros/s/AKfycbyjhVoFuBThqJlBensobrcyh8hFIEGO44l_wb8MCFH1xsEJf2DnD3UMtSblUxosBi5gKg/exec"; // â† ØºÙŠÙ‘Ø± Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø·Ùƒ

  function verifyLogin() {
    const username = document.getElementById("adminUsername").value;
    const password = document.getElementById("adminPassword").value;

    fetch(LOGIN_API, {
      method: "POST",
      body: JSON.stringify({ username, password })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        localStorage.setItem("dashboard-auth", "true");
        showDashboard();
      } else {
        document.getElementById("loginError").textContent = "âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
      }
    })
    .catch(() => {
      document.getElementById("loginError").textContent = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±";
    });
  }

  function showDashboard() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("dashboardContent").style.display = "block";
  }

  window.onload = () => {
    if (localStorage.getItem("dashboard-auth") === "true") {
      showDashboard();
    }
  };
</script>
  <script>
    const PRODUCTS_API_URL = "https://script.google.com/macros/s/AKfycbyQ1eG5EynTHOpxJNFQBVJiAU5QTX880Y-jctfM1GS1UVkpOXOFZ_SEqI1GTAQ87UUPhA/exec";
    const ORDERS_API_URL = "https://script.google.com/macros/s/AKfycbw-pT4ThTSIDbAlBfe-r2Q6rIkW9LFYRqWhLqlC8ExvJEb9l0V_WIlR--9F4ze2_ycn/exec";

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function loadProducts() { 
  fetch(PRODUCTS_API_URL)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#productsTable tbody");
      tbody.innerHTML = '';

      data
        .filter(p => p.name && p.name.trim() !== '') // âœ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…
        .forEach(p => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td>${p.oldPrice}</td>
            <td>${p.category}</td>
            <td>${p.shortDesc}</td>
            <td>${p.available}</td>
            <td>
              <button class="btn btn-sm btn-warning me-1" onclick='editProduct(${JSON.stringify(p)})'>âœ</button>
              <button class="btn btn-sm btn-danger" onclick='deleteProduct("${p.id}")'>ğŸ—‘ï¸</button>
            </td>`;
          tbody.appendChild(tr);
        });
    });
}

    function editProduct(p) {
      document.getElementById('product-id').value = p.id || '';
      document.getElementById('product-name').value = p.name || '';
      document.getElementById('product-price').value = p.price || '';
      document.getElementById('product-oldPrice').value = p.oldPrice || '';
      document.getElementById('product-category').value = p.category || '';
      document.getElementById('product-shortDesc').value = p.shortDesc || '';
      document.getElementById('product-description').value = p.description || '';
      document.getElementById('product-images').value = p.images || '';
      document.getElementById('product-colors').value = p.colors || '';
      document.getElementById('product-available').value = p.available || '';
    }

    document.getElementById("productForm").addEventListener("submit", e => {
  e.preventDefault();

  const idField = document.getElementById('product-id');
  const isEdit = !!idField.value;

  const data = {
    id: idField.value || Date.now(),
    name: document.getElementById('product-name').value,
    price: document.getElementById('product-price').value,
    oldPrice: document.getElementById('product-oldPrice').value,
    category: document.getElementById('product-category').value,
    shortDesc: document.getElementById('product-shortDesc').value,
    description: document.getElementById('product-description').value,
    available: document.getElementById('product-available').value,
    colors: document.getElementById('product-colors').value,
    images: document.getElementById('product-images').value,
  };

  fetch(PRODUCTS_API_URL, {
    method: "POST",
    body: JSON.stringify(data),
  }).then(() => {
    loadProducts();
    e.target.reset();
    idField.value = "";

    const messageEl = document.getElementById("product-message");
messageEl.textContent = isEdit
  ? "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­"
  : "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬";
messageEl.className = "alert alert-success mt-3";
messageEl.style.display = "block";

setTimeout(() => {
  messageEl.style.display = "none";
}, 3000);
  }).catch(() => {
    const messageEl = document.getElementById("product-message");
    messageEl.classList.remove("alert-success");
    messageEl.classList.add("alert-danger");
    messageEl.innerHTML = "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„";
    messageEl.style.display = "block";
  });
});



    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    function loadOrders() {
      fetch(ORDERS_API_URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#ordersTable tbody");
          tbody.innerHTML = '';
        

          data.filter(p => p.name && p.name.trim() !== '').forEach(order => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${order.name}</td>
              <td>${order.phone}</td>
              <td>${order.area}</td>
              <td>${order.address}</td>
              <td>${order.payment}</td>
              <td><pre>${order.items}</pre></td>
              <td>${order.deliveryFee}</td>
              <td>${order.discountAmount}</td>
              <td>${order.coupon}</td>
              <td>${order.total}</td>
              <td>${new Date(order.date || order.Timestamp).toLocaleString()}</td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function filterOrders() {
  const keyword = document.getElementById("searchOrdersInput").value.toLowerCase();
  const rows = document.querySelectorAll("#ordersTable tbody tr");

  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();     // Ø§Ù„Ø§Ø³Ù…
    const date = row.cells[10].textContent.toLowerCase();    // Ø§Ù„ØªØ§Ø±ÙŠØ®

    const match = name.includes(keyword) || date.includes(keyword);
    row.style.display = match ? "" : "none";
  });
}

function deleteProduct(productId) {
  if (!confirm("â— Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;

 fetch(PRODUCTS_API_URL + "?_method=DELETE", {
  method: "POST",
  body: JSON.stringify({ id: productId })
})
  .then(res => res.json())
  .then(res => {
    if (res.success) {
      alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬");
      loadProducts();
    } else {
      alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + res.message);
    }
  })
  .catch(() => alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø­Ø°Ù"));
}

    loadProducts();
    loadOrders();

    const cloudName = "dezvuqqrl"; // Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ø³Ù… Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Cloudinary
const uploadPreset = "unsigned_preset"; // Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ù€ unsigned preset Ù…Ù† Cloudinary

document.getElementById('product-image-file').addEventListener('change', async function () {
  const files = this.files;
  const status = document.getElementById('upload-status');
  const imageLinks = [];

  status.textContent = 'ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±...';

  for (const file of files) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", uploadPreset);

    try {
      const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      if (data.secure_url) {
        imageLinks.push(data.secure_url);
      } else {
        alert("âŒ ÙØ´Ù„ Ø±ÙØ¹ ØµÙˆØ±Ø©: " + file.name);
      }
    } catch (err) {
      alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: " + err.message);
    }
  }

  document.getElementById('product-images').value = imageLinks.join(", ");
  status.textContent = `âœ… ØªÙ… Ø±ÙØ¹ ${imageLinks.length} ØµÙˆØ±Ø©`;
});

  </script>
</body>
</html>
